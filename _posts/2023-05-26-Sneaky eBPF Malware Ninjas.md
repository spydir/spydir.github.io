---
layout: post
title: Sneaky eBPF Malware Ninjas
---
Hey folks, it's Lee again, your neighborhood InfoSec nerd. This time, we're diving headfirst into something that's been keeping me up at night, and not because I've been binging on sci-fi shows. We're delving into the intriguing world of eBPF (Extended Berkeley Packet Filter) and a new trend that's been popping up like a troublesome patch of clover in a lush lawn – eBPF *malware*. Buckle up, folks, we're in for a wild ride.

First off, let's break down what eBPF is for those scratching their heads. In the simplest terms, eBPF is a technology baked into the Linux kernel ([since version 3.18](https://kernelnewbies.org/Linux_3.18#bpf.28.29_syscall_for_eBFP_virtual_machine_programs)) that lets you run custom sandboxed programs in kernel space without changing the kernel source code or loading kernel modules. In other words, it's a customizable mini-program running in the kernel without making the kernel sweat too much.

Now you might be thinking, "Okay, cool. But what's this got to do with malware?" Well, that's where the plot thickens. You see, eBPF is sort of like a genie – it can grant your every wish, for better or worse. It can be used to supercharge network performance, introduce new security features, or, if you're a sneaky cyber criminal, to create malware that's harder to detect and eliminate. 

Now, onto the 'fun' part: the burgeoning eBPF malware trend. Now, we're not quite at *'SkyNet taking over the world'* levels yet, but it's something to keep an eye on. Since eBPF programs can operate in kernel space and can be hooked onto various parts of a system's operation, they can act as a stealthy hideout for malicious code.

For us, the defenders, it's like playing hide-and-seek with the lights out, and the malware is a ninja with night-vision goggles. It's challenging, it's a bit scary, but boy, does it make our job interesting. 

I've been neck-deep in research on this topic, and let me tell you, it's been a wild ride. I first learned about eBPF malware at [CackalackyCon](https://cackalackycon.org/) from [threlfall's](https://infocondb.org/presenter/adrian-wood-threlfall) presentation.[What-the-edr-doing?](https://www.youtube.com/watch?v=DLDrsSb_iqI&themeRefresh=1) 

Since then, I've been crawling through research papers, case studies, and the few samples I can find (my coffee machine has been working overtime).  The team over at PWC had some great primary research on this last year, see pages 37 and 60 for BPFDoor examples: 

[https://www.pwc.com/gx/en/issues/cybersecurity/cyber-threat-intelligence/cyber-year-in-retrospect/yir-cyber-threats-report-download.pdf]

The conclusion? eBPF malware is a new frontier in the eternal cat-and-mouse game between attackers and defenders. And we're still figuring out how to spot the sneaky ninja.

Now, this doesn't mean you should start panicking and ditching all things eBPF. On the contrary, eBPF is a powerful technology with immense potential. But as with any tool, it can be used for good or evil. It's our job to understand it, embrace it, and be ready to protect against its misuse.

So what's the game plan? Research, research, and more research. The more we understand about eBPF – how it works, what it can do, how it can be exploited – the better equipped we'll be to defend against eBPF-based attacks. And hey, it's not every day you get to be a pioneer, right?

In the end, it's all about staying one step ahead. We're on the cutting edge here, and while it might seem daunting, it's also exciting. We're in uncharted territory, mapping out new defensive strategies and uncovering new threats. It's what makes InfoSec so fascinating.

And hey, who knows? Maybe in a few years, we'll look back at this post and laugh at how much we didn't know. But for now, we're in the thick of it, learning, adapting, and fighting back. Because that's what we do.


P.S. - I would be remiss if I didn’t include a note on further references and research.

The most comprehensive reference is Awesome-eBPF which is, well.. it’s awesome. It’s the Crown Jewel of those looking to dive into eBPF research and there’s a lot of very-well curated content there. However, there’s a lot there and it’s not very approachable for n00bs like me. It’s kind of like the Rollex of eBPF references where some of us just need a nice Timex or G-Shock as we figure out how to wear a watch for the first time. 

Rollex (Pure awesome): https://github.com/zoidbergwill/awesome-ebpf

Timex (Research):
- https://ebpf.io/what-is-ebpf/
- https://redcanary.com/blog/ebpf-malware/
- https://thenewstack.io/the-symbiote-malware-what-we-know-so-far/
- https://cymulate.com/blog/ebpf_hacking/
- https://thestack.technology/bpfdoor-chinese-tool-almost-undeatected/

G-Shock (Samples & Tools)
- BPFDoor: https://bazaar.abuse.ch/sample/93f4262fce8c6b4f8e239c35a0679fbbbb722141b95a5f2af53a2bcafe4edd1c/
- https://github.com/pathtofile/bad-bpf

There’s more to follow on this one, for sure. So, until next time, happy hacking!

-spydir

